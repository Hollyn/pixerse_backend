FROM node:18-alpine

WORKDIR /app

# Copy package files and install only production dependencies
COPY package*.json ./
RUN npm ci --only=production && npm cache clean --force

# Copy pre-built application (built locally)
COPY ./build ./build
COPY ./dist ./dist
COPY ./public ./public
COPY ./config ./config
COPY ./src ./src

# Copy other necessary files
COPY *.js ./
COPY *.json ./

EXPOSE 1337

USER node

CMD ["npm", "run", "start"]
